{% extends "layout.html" %}

{% block page_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='ace/css/chosen.min.css') }}" />
{% endblock %}

{% block parent_node %}<a href="{{ url_for('web.index') }}">Home</a>{% endblock %}
{% block current_node %}用户管理{% endblock %}

{% block content %}
    <div class="tabbable">
        <ul class="nav nav-tabs tab-size-bigger">
            <li class="active"><a data-toggle="tab" href="#adminUser">用户</a></li>
            <li class=""><a data-toggle="tab" href="#adminGroup">用户组</a></li>
            <li class=""><a data-toggle="tab" href="#adminSelector">权限</a></li>
        </ul>
        <div class="tab-content padding-24">
            {% macro macro_roles() %}

                {% for role in roles %}
                    <option value="{{ role.cname }}">{{ role.cname }}</option>
                {% endfor %}
            {% endmacro %}

            <div id="adminUser" class="tab-pane fade in active">
                <div class="row"><div class="col-xs-12">
                  {#  {%- if 'adminCreateUser' in session.get('selectors', ()) -%}  #}
                        <button class="btn btn-xs btn-info" onclick="$('#modal-form-add-user').modal('show');">
                            <i class="ace-icon fa fa-plus bigger-120"></i>
                        </button>
                   {# {%- endif -%}  #}
                    <table class="table table-striped table-bordered table-hover">
                        <thead>
                        <tr>
                            <th>帐号</th>
                            <th>姓名</th>
                            <th>邮箱</th>
                            <th>电话</th>
                            <th>KEY</th>
                            <th>公司</th>
                            <th style="display: none">部门</th>
                            <th >角色</th>
                             <th >激活</th>
                            <th>用户组</th>
                            <th></th>
                        </tr>
                        </thead>
                        <tbody>
                        {%- for user in users -%}
                            <tr id="user-{{ user.id }}">
                                <td>{{ user.name }}</td>
                                <td>{{ user.cname }}</td>
                                <td>{{ user.email }}</td>
                                <td>{{ user.mobile }}</td>
                                <td>{{ user.scan_key }}</td>
                                <td>{{ user.company }}</td>
                                <td style="display: none">{{ user.department }}</td>
                                <td>{{ user | get_role }}</td>
                                <td>{% if user.status==1 %}是{% else %}否
                                    {% endif %}
                                </td>
                                <td>{{ user.groups }}</td>
                                <td>
                                    <div class="hidden-sm hidden-xs btn-group">
                                      {#    {%- if 'adminCreateUser' in session.get('selectors', ()) -%} #}
                                            <button class="btn btn-xs btn-info" onclick="userOnclick('{{ user.id }}');">
                                                <i class="ace-icon fa fa-pencil bigger-120"></i>
                                            </button>
                                    {#    {%- endif %}
                                        {%- if 'adminDeleteUser' in session.get('selectors', ()) -%}  #}
                                            <button class="btn btn-xs btn-danger" onclick="del_user('{{ user.id }}');">
                                                <i class="ace-icon fa fa-trash-o bigger-120"></i>
                                            </button>
                                    {#    {%- endif -%} #}
                                    </div>
                                </td>
                            </tr>
                        {%- endfor -%}
                        </tbody>
                    </table>
                </div></div>
            </div>
            <div id="adminGroup" class="tab-pane fade">
                <div class="row"><div class="col-xs-12">
{#                    {%- if 'adminCreateGroup' in session.get('selectors', ()) -%}#}
                        <button class="btn btn-xs btn-info" onclick="$('#modal-form-add-group').modal('show');">
                            <i class="ace-icon fa fa-plus bigger-120"></i>
                        </button>
{#                    {%- endif -%}#}
                    <table class="table table-striped table-bordered table-hover">
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>名称</th>
                            <th>说明</th>
                            <th>权限</th>
                            <th></th>
                        </tr>
                        </thead>
                        <tbody>
                        {%- for group in groups -%}
                            <tr id="group-{{ group.id }}">
                                <td>{{ group.id }}</td>
                                <td>{{ group.name }}</td>
                                <td>{{ group.cname }}</td>
                                <td>{{ group.selectors }}</td>
                                <td>
                                    <div class="hidden-sm hidden-xs btn-group">
{#                                        {%- if 'adminCreateGroup' in session.get('selectors', ()) -%}#}
                                            <button class="btn btn-xs btn-info" onclick="groupOnclick('{{ group.id }}');">
                                                <i class="ace-icon fa fa-pencil bigger-120"></i>
                                            </button>
{#                                        {%- endif -%}#}
{#                                        {%- if 'adminDeleteGroup' in session.get('selectors', ()) -%}#}
                                            <button class="btn btn-xs btn-danger" onclick="delete_group('{{ group.id }}');">
                                                <i class="ace-icon fa fa-trash-o bigger-120"></i>
                                            </button>
{#                                        {%- endif -%}#}
                                    </div>
                                </td>
                            </tr>
                        {%- endfor -%}
                        </tbody>
                    </table>
                </div></div>
            </div>
            <div id="adminSelector" class="tab-pane fade">
                <div class="row"><div class="col-xs-12">

                        <button class="btn btn-xs btn-info" onclick="$('#modal-form-add-selector').modal('show');">
                            <i class="ace-icon fa fa-plus bigger-120"></i>
                        </button>

                    <table class="table table-striped table-bordered table-hover">
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>名称</th>
                            <th>说明</th>
                            <th>类型</th>
                            <th></th>
                        </tr>
                        </thead>
                        <tbody>
                        {%- for selector in selectors -%}
                            <tr id="selector-{{ selector.id }}">
                                <td>{{ selector.id }}</td>
                                <td>{{ selector.name }}</td>
                                <td>{{ selector.cname }}</td>
                                <td>{{ selector.kind }}</td>
                                <td>
                                    <div class="hidden-sm hidden-xs btn-group">
                                    {# {% if 'adminCreateSelector' in session.get('selectors', ()) %} #}
                                        <button class="btn btn-xs btn-info" onclick="selectorOnclick('{{ selector.id }}');">
                                            <i class="ace-icon fa fa-pencil bigger-120"></i>
                                        </button>
                                  {#   {% endif %}  #}
                                    {# {%- if 'adminDeleteSelector' in session.get('selectors', ()) -%} #}
                                        <button class="btn btn-xs btn-danger" onclick="delete_selector('{{ selector.id }}');">
                                            <i class="ace-icon fa fa-trash-o bigger-120"></i>
                                        </button>
                                   {#  {%- endif -%}  #}
                                    </div>
                                </td>
                            </tr>
                        {%- endfor -%}
                        </tbody>
                    </table>
                </div></div>
            </div>
        </div>
    </div>
    <div id="modal-form-add-user" class="modal fade" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" onclick="$('#modal-form-add-user').modal('hide');">&times;</button>
                    <h4 class="blue bigger">请提交用户信息:</h4>
                </div>
                <form class="form-horizontal">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9">
                                <div class="form-group">
                                    <label class="control-label col-xs-12 col-sm-3 no-padding-right" for="modal-form-add-userName">帐号：</label>
                                    <div class="col-xs-12 col-sm-9">
                                        <div class="clearfix">
                                            <input required type="text" id="modal-form-add-userName" name="name" class="col-xs-12 col-sm-10">
                                        </div>
                                    </div>
                                </div>
                                <div class="space-2"></div>

                                <div class="form-group">
                                    <label class="control-label col-xs-12 col-sm-3 no-padding-right" for="modal-form-add-userCName">姓名：</label>
                                    <div class="col-xs-12 col-sm-9">
                                        <div class="clearfix">
                                            <input required type="text" id="modal-form-add-userCName" name="cname" class="col-xs-12 col-sm-10">
                                        </div>
                                    </div>
                                </div>
                                <div class="space-2"></div>

                                <div class="form-group">
                                    <label class="control-label col-xs-12 col-sm-3 no-padding-right" for="modal-form-add-userEmail">邮箱：</label>
                                    <div class="col-xs-12 col-sm-9">
                                        <div class="clearfix">
                                            <input required type="text" id="modal-form-add-userEmail" name="email" class="col-xs-12 col-sm-10">
                                        </div>
                                    </div>
                                </div>
                                <div class="space-2"></div>

                                <div class="form-group">
                                    <label class="control-label col-xs-12 col-sm-3 no-padding-right" for="modal-form-add-userEmail">联系方式：</label>
                                    <div class="col-xs-12 col-sm-9">
                                        <div class="clearfix">
                                            <input required type="text" id="modal-form-add-userMoblile" name="mobile" class="col-xs-12 col-sm-10">
                                        </div>
                                    </div>
                                </div>
                                <div class="space-2"></div>

                                <div class="form-group">
                                    <label class="control-label col-xs-12 col-sm-3 no-padding-right" for="modal-form-add-userDepartment">公司：</label>
                                    <div class="col-xs-12 col-sm-9">
                                        <div class="clearfix">
                                            <input  type="text" id="modal-form-add-userCompany" name="company" class="col-xs-12 col-sm-10">
                                        </div>
                                    </div>
                                </div>
                                <div class="space-2"></div>

                                <div class="form-group">
                                    <label class="control-label col-xs-12 col-sm-3 no-padding-right" for="modal-form-add-userDepartment">部门：</label>
                                    <div class="col-xs-12 col-sm-9">
                                        <div class="clearfix">
                                            <input  type="text" id="modal-form-add-userDepartment" name="department" class="col-xs-12 col-sm-10">
                                        </div>
                                    </div>
                                </div>
                                <div class="space-2"></div>

                                <div class="form-group">
                                    <label class="control-label col-xs-12 col-sm-3 no-padding-right" for="modal-form-add-userGroups">所属用户组：</label>
                                    <div class="col-xs-12 col-sm-9">
                                        <div class="clearfix">
                                            <input  type="text" id="modal-form-add-userGroups" name="groups" class="col-xs-12 col-sm-10" placeholder="请填写用户组ID，并用用英文逗号分隔">
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-xs-12 col-sm-3 no-padding-right" for="modal-form-add-userDepartment">密码：</label>
                                    <div class="col-xs-12 col-sm-9">
                                        <div class="clearfix">
                                            <input required type="password" id="modal-form-add-userpwd" name="password" class="col-xs-12 col-sm-10">
                                        </div>
                                    </div>
                                </div>
                                <div class="space-2"></div>
                                <div class="form-group">
                                    <label class="control-label col-xs-12 col-sm-3 no-padding-right" for="modal-form-add-userDepartment">确认密码：</label>
                                    <div class="col-xs-12 col-sm-9">
                                        <div class="clearfix">
                                            <input required type="password" id="modal-form-add-userRepwd" name="repassword" class="col-xs-12 col-sm-10">
                                        </div>
                                    </div>
                                </div>

                            </div>

                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-sm btn-primary">
                            <i class="ace-icon fa fa-check"></i>
                            Submit
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div id="modal-form-user" class="modal fade" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" onclick="$('#modal-form-user').modal('hide');">&times;</button>
                    <h4 class="blue bigger">请更新用户信息:</h4>
                </div>
                <form class="form-horizontal">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9">
                                <label for="modal-form-userId" style="display: none;"></label>
                                <input required readonly type="text" id="modal-form-userId" name="id" style="display: none;">
                                <label for="modal-form-userName" style="display: none;">帐号：</label>
                                <input required readonly type="text" id="modal-form-userName" name="name" style="display: none;">
                                <div class="form-group">
                                    <label class="control-label col-xs-12 col-sm-3 no-padding-right" for="modal-form-userCName">姓名：</label>
                                    <div class="col-xs-12 col-sm-9">
                                        <div class="clearfix">
                                            <input required type="text" id="modal-form-userCName" name="cname" class="col-xs-12 col-sm-10">
                                        </div>
                                    </div>
                                </div>
                                <div class="space-2"></div>

                                <div class="form-group">
                                    <label class="control-label col-xs-12 col-sm-3 no-padding-right" for="modal-form-userEmail">邮箱：</label>
                                    <div class="col-xs-12 col-sm-9">
                                        <div class="clearfix">
                                            <input required type="text" id="modal-form-userEmail" name="email" class="col-xs-12 col-sm-10">
                                        </div>
                                    </div>
                                </div>
                                <div class="space-2"></div>
                                 <div class="form-group">
                                    <label class="control-label col-xs-12 col-sm-3 no-padding-right" for="modal-form-add-userEmail">联系方式：</label>
                                    <div class="col-xs-12 col-sm-9">
                                        <div class="clearfix">
                                            <input required type="text" id="modal-form-userMoblile" name="mobile" class="col-xs-12 col-sm-10">
                                        </div>
                                    </div>
                                </div>
                                <div class="space-2"></div>
                                <div class="form-group">
                                    <label class="control-label col-xs-12 col-sm-3 no-padding-right" for="modal-form-add-userDepartment">公司：</label>
                                    <div class="col-xs-12 col-sm-9">
                                        <div class="clearfix">
                                            <input  type="text" id="modal-form-userCompany" name="company" class="col-xs-12 col-sm-10">
                                        </div>
                                    </div>
                                </div>
                                <div class="space-2"></div>

                                <div class="form-group">
                                    <label class="control-label col-xs-12 col-sm-3 no-padding-right" for="modal-form-userDepartment">部门：</label>
                                    <div class="col-xs-12 col-sm-9">
                                        <div class="clearfix">
                                            <input  type="text" id="modal-form-userDepartment" name="department" class="col-xs-12 col-sm-10">
                                        </div>
                                    </div>
                                </div>
                                <div class="space-2"></div>
                                <div class="form-group">
                                    <label class="control-label col-xs-12 col-sm-3 no-padding-right" for="modal-form-userDepartment">角色：</label>
                                    <div class="col-xs-12 col-sm-9">
                                        <div class="clearfix">
                                            <select   id="modal-form-userRole" name="user_role" class="form-control">
                                                {{ macro_roles() }}
                                            </select>

                                        </div>
                                    </div>
                                </div>
                                <div class="space-2"></div>

								
								<div class="form-group">
                                    <label class="control-label col-xs-12 col-sm-3 no-padding-right" for="modal-form-userDepartment">激活：</label>
                                    <div class="col-xs-12 col-sm-9">
                                        <div class="clearfix">
                                            <label>
                                            <input id="modal-form-userStatus" name="user_status" class="ace ace-switch ace-switch-6" type="checkbox" checked>
                                             <span class="lbl"></span>
                                             </label>
                                        </div>
                                        <div class="clearfix">

                        </div>
                                    </div>
                                </div>
                                <div class="space-2"></div>

                                <div class="form-group">
                                    <label class="control-label col-xs-12 col-sm-3 no-padding-right" for="modal-form-userGroups">所属用户组：</label>
                                    <div class="col-xs-12 col-sm-9">
                                        <div class="clearfix">
                                            <input required type="text" id="modal-form-userGroups" name="groups" class="col-xs-12 col-sm-10">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-sm btn-primary">
                            <i class="ace-icon fa fa-check"></i>
                            Submit
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div id="modal-form-add-group" class="modal fade" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" onclick="$('#modal-form-add-group').modal('hide');">&times;</button>
                    <h4 class="blue bigger">请提交用户组信息:</h4>
                </div>
                <form class="form-horizontal">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9">
                                <div class="form-group">
                                    <label class="control-label col-xs-12 col-sm-3 no-padding-right" for="modal-form-add-groupName">名称：</label>
                                    <div class="col-xs-12 col-sm-9">
                                        <div class="clearfix">
                                            <input required type="text" id="modal-form-add-groupName" name="name" class="col-xs-12 col-sm-10">
                                        </div>
                                    </div>
                                </div>
                                <div class="space-2"></div>

                                <div class="form-group">
                                    <label class="control-label col-xs-12 col-sm-3 no-padding-right" for="modal-form-add-groupCName">说明：</label>
                                    <div class="col-xs-12 col-sm-9">
                                        <div class="clearfix">
                                            <input required type="text" id="modal-form-add-groupCName" name="cname" class="col-xs-12 col-sm-10">
                                        </div>
                                    </div>
                                </div>
                                <div class="space-2"></div>

                                <div class="form-group">
                                    <label class="control-label col-xs-12 col-sm-3 no-padding-right" for="modal-form-add-groupSelectors">权限：</label>
                                    <div class="col-xs-12 col-sm-9">
                                        <div class="clearfix">
                                            <input required type="text" id="modal-form-add-groupSelectors" name="selectors" class="col-xs-12 col-sm-10" placeholder="请填写权限ID，并用用英文逗号分隔">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-sm btn-primary">
                            <i class="ace-icon fa fa-check"></i>
                            Submit
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div id="modal-form-group" class="modal fade" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" onclick="$('#modal-form-group').modal('hide');">&times;</button>
                    <h4 class="blue bigger">请更新用户组信息:</h4>
                </div>
                <form class="form-horizontal">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9">
                                <label for="modal-form-groupId" style="display: none;"></label>
                                <input required readonly type="text" id="modal-form-groupId" name="id" style="display: none;">
                                <div class="form-group">
                                    <label class="control-label col-xs-12 col-sm-3 no-padding-right" for="modal-form-groupName">名称：</label>
                                    <div class="col-xs-12 col-sm-9">
                                        <div class="clearfix">
                                            <input required type="text" id="modal-form-groupName" name="name" class="col-xs-12 col-sm-10">
                                        </div>
                                    </div>
                                </div>
                                <div class="space-2"></div>

                                <div class="form-group">
                                    <label class="control-label col-xs-12 col-sm-3 no-padding-right" for="modal-form-groupCName">说明：</label>
                                    <div class="col-xs-12 col-sm-9">
                                        <div class="clearfix">
                                            <input required type="text" id="modal-form-groupCName" name="cname" class="col-xs-12 col-sm-10">
                                        </div>
                                    </div>
                                </div>
                                <div class="space-2"></div>

                                <div class="form-group">
                                    <label class="control-label col-xs-12 col-sm-3 no-padding-right" for="modal-form-groupSelectors">权限：</label>
                                    <div class="col-xs-12 col-sm-9">
                                        <div class="clearfix">
                                            <input required type="text" id="modal-form-groupSelectors" name="selectors" class="col-xs-12 col-sm-10">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-sm btn-primary">
                            <i class="ace-icon fa fa-check"></i>
                            Submit
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div id="modal-form-add-selector" class="modal fade" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" onclick="$('#modal-form-add-selector').modal('hide');">&times;</button>
                    <h4 class="blue bigger">请提交权限信息:</h4>
                </div>
                <form class="form-horizontal">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9">
                                <div class="form-group">
                                    <label class="control-label col-xs-12 col-sm-3 no-padding-right" for="modal-form-add-selectorName">名称：</label>
                                    <div class="col-xs-12 col-sm-9">
                                        <div class="clearfix">
                                            <input required type="text" id="modal-form-add-selectorName" name="name" class="col-xs-12 col-sm-10">
                                        </div>
                                    </div>
                                </div>
                                <div class="space-2"></div>

                                <div class="form-group">
                                    <label class="control-label col-xs-12 col-sm-3 no-padding-right" for="modal-form-add-selectorCName">说明：</label>
                                    <div class="col-xs-12 col-sm-9">
                                        <div class="clearfix">
                                            <input required type="text" id="modal-form-add-selectorCName" name="cname" class="col-xs-12 col-sm-10">
                                        </div>
                                    </div>
                                </div>
                                <div class="space-2"></div>

                                <div class="form-group">
                                    <label class="control-label col-xs-12 col-sm-3 no-padding-right" for="modal-form-add-selectorKind">类型：</label>
                                    <div class="col-xs-12 col-sm-9">
                                        <div class="clearfix">
                                            <input required type="text" id="modal-form-add-selectorKind" name="kind" class="col-xs-12 col-sm-10">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-sm btn-primary">
                            <i class="ace-icon fa fa-check"></i>
                            Submit
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div id="modal-form-selector" class="modal fade" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" onclick="$('#modal-form-selector').modal('hide');">&times;</button>
                    <h4 class="blue bigger">请更新权限信息:</h4>
                </div>
                <form class="form-horizontal">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9">
                                <label for="modal-form-selectorId" style="display: none;"></label>
                                <input required readonly type="text" id="modal-form-selectorId" name="id" style="display: none;">

                                <div class="form-group">
                                    <label class="control-label col-xs-12 col-sm-3 no-padding-right" for="modal-form-selectorName">名称：</label>
                                    <div class="col-xs-12 col-sm-9">
                                        <div class="clearfix">
                                            <input required type="text" id="modal-form-selectorName" name="name" class="col-xs-12 col-sm-10">
                                        </div>
                                    </div>
                                </div>
                                <div class="space-2"></div>

                                <div class="form-group">
                                    <label class="control-label col-xs-12 col-sm-3 no-padding-right" for="modal-form-selectorCName">说明：</label>
                                    <div class="col-xs-12 col-sm-9">
                                        <div class="clearfix">
                                            <input required type="text" id="modal-form-selectorCName" name="cname" class="col-xs-12 col-sm-10">
                                        </div>
                                    </div>
                                </div>
                                <div class="space-2"></div>

                                <div class="form-group">
                                    <label class="control-label col-xs-12 col-sm-3 no-padding-right" for="modal-form-selectorKind">类型：</label>
                                    <div class="col-xs-12 col-sm-9">
                                        <div class="clearfix">
                                            <input required type="text" id="modal-form-selectorKind" name="kind" class="col-xs-12 col-sm-10">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-sm btn-primary">
                            <i class="ace-icon fa fa-check"></i>
                            Submit
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
{% endblock %}

{% block page_js %}
<script src="{{ url_for('static', filename='ace/js/chosen.jquery.min.js') }}"></script>
<script src="{{ url_for('static', filename='ace/js/jquery.validate.min.js') }}"></script>
{% endblock %}
{% block inline_js %}
<script type="text/javascript">
function create_user(form) {
    var fd = new FormData(form);
    $.ajax({
        url: "{{ url_for('web.create_user') }}",
        type: "POST",
        data: fd,
        enctype: "multipart/form-data",
        processData: false,
        contentType: false,
        statusCode: {
                403: function () {
                    alert("权限不足, 请联系管理员");
                }
        }
    }).done(function (result) {
        alert(result.desc);
        if (result.status) {
            window.location.href="{{ url_for('web.user_list') }}";
        }
    });
    return false;
}
function put_user(form) {
    var fd = new FormData(form);
    var userId = $('#modal-form-userId').val();
    $.ajax({
        url: "{{ url_for('web.create_user') }}/"+userId,
        type: "PUT",
        data: fd,
        enctype: "multipart/form-data",
        processData: false,
        contentType: false,
        statusCode: {
                403: function () {
                    alert("权限不足, 请联系管理员");
                }
        }
    }).done(function (result) {
        alert(result.desc);
        if (result.status) {
            window.location.href="{{ url_for('web.user_list') }}";
        }
    });
    return false;
}
function del_user(userId) {

    if (!window.confirm('是否_停用用户_')) {
    } else {
        $.ajax({
            url: "{{ url_for('web.create_user') }}/"+userId,
            type: "DELETE",
            enctype: "multipart/form-data",
            processData: false,
            contentType: false,
            statusCode: {
                403: function () {
                    alert("权限不足, 请联系管理员");
                }
            }
        }).done(function (result) {
            alert(result.desc);
            if (result.status) {
                window.location.href = "{{ url_for('web.user_list') }}";
            }
        });
    }
    return false;
}
function userOnclick(userId) {
    var tr = $('#user-'+userId);
    document.getElementById('modal-form-userId').value = userId;
    document.getElementById('modal-form-userName').value = tr.find('td:eq(0)').text();
    document.getElementById('modal-form-userCName').value = tr.find('td:eq(1)').text();
    document.getElementById('modal-form-userEmail').value = tr.find('td:eq(2)').text();
    document.getElementById('modal-form-userMoblile').value = tr.find('td:eq(3)').text();
    document.getElementById('modal-form-userCompany').value = tr.find('td:eq(5)').text();
    document.getElementById('modal-form-userDepartment').value = tr.find('td:eq(6)').text();
    //document.getElementById('modal-form-userRole').value = tr.find('td:eq(7)').text();
    var $opt = $("#modal-form-userRole option[value='"+tr.find('td:eq(7)').text()+"']");
    $opt.attr("selected", true);
    document.getElementById('modal-form-userGroups').value = tr.find('td:eq(9)').text();
    $('#modal-form-user').modal('show');
    return false;
}

function create_group(form) {
    var fd = new FormData(form);
    $.ajax({
        url: "{{ url_for('web.create_group') }}",
        type: "POST",
        data: fd,
        enctype: "multipart/form-data",
        processData: false,
        contentType: false,
        statusCode: {
                403: function () {
                    alert("权限不足, 请联系管理员");
                }
        }
    }).done(function (result) {
        alert(result.desc);
        if (result.status) {
            window.location.href="{{ url_for('web.user_list') }}";
        }
    });
    return false;
}
function put_group(form) {
    var fd = new FormData(form);
    var groupId = $('#modal-form-groupId').val();
    $.ajax({
        url: "{{ url_for('web.create_group') }}/"+groupId,
        type: "PUT",
        data: fd,
        enctype: "multipart/form-data",
        processData: false,
        contentType: false,
        statusCode: {
                403: function () {
                    alert("权限不足, 请联系管理员");
                }
        }
    }).done(function (result) {
        alert(result.desc);
        if (result.status) {
            window.location.href="{{ url_for('web.user_list') }}";
        }
    });
    return false;
}
function delete_group(groupId) {
    if (window.confirm('是否_删除_')) {
        $.ajax({
            url: "{{ url_for('web.create_group') }}/"+groupId,
            type: "DELETE",
            enctype: "multipart/form-data",
            processData: false,
            contentType: false,
            statusCode: {
                403: function () {
                    alert("权限不足, 请联系管理员");
                }
            }
        }).done(function (result) {
            alert(result.desc);
            if (result.status) {
                window.location.href = "{{ url_for('web.user_list') }}";
            }
        });
    }
    return false;
}
function groupOnclick(groupId) {
    var tr = $('#group-'+groupId);
    document.getElementById('modal-form-groupId').value = groupId;
    document.getElementById('modal-form-groupName').value = tr.find('td:eq(1)').text();
    document.getElementById('modal-form-groupCName').value = tr.find('td:eq(2)').text();
    document.getElementById('modal-form-groupSelectors').value = tr.find('td:eq(3)').text();
    $('#modal-form-group').modal('show');
    return false;
}

function create_selector(form) {
    var fd = new FormData(form);
    $.ajax({
        url: "{{ url_for('web.create_selector') }}",
        type: "POST",
        data: fd,
        enctype: "multipart/form-data",
        processData: false,
        contentType: false,
        statusCode: {
                403: function () {
                    alert("权限不足, 请联系管理员");
                }
        }
    }).done(function (result) {
        alert(result.desc);
        if (result.status) {
            window.location.href="{{ url_for('web.user_list') }}";
        }
    });
    return false;
}
function put_selector(form) {
    var fd = new FormData(form);
    var selectorId = $('#modal-form-selectorId').val();
    $.ajax({
        url: "{{ url_for('web.create_selector') }}/"+selectorId,
        type: "PUT",
        data: fd,
        enctype: "multipart/form-data",
        processData: false,
        contentType: false,
        statusCode: {
                403: function () {
                    alert("权限不足, 请联系管理员");
                }
        }
    }).done(function (result) {
        alert(result.desc);
        if (result.status) {
            window.location.href="{{ url_for('web.user_list') }}";
        }
    });
    return false;
}
function delete_selector(selectorId) {
    if (window.confirm('是否_删除_')) {
        $.ajax({
            url: "{{ url_for('web.create_selector') }}/"+selectorId,
            type: "DELETE",
            enctype: "multipart/form-data",
            processData: false,
            contentType: false,
            statusCode: {
                403: function () {
                    alert("权限不足, 请联系管理员");
                }
            }
        }).done(function (result) {
            alert(result.desc);
            if (result.status) {
                window.location.href = "{{ url_for('web.user_list') }}";
            }
        });
    }
    return false;
}
function selectorOnclick(selectorId) {
    var tr = $('#selector-'+selectorId);
    document.getElementById('modal-form-selectorId').value = selectorId;
    document.getElementById('modal-form-selectorName').value = tr.find('td:eq(1)').text();
    document.getElementById('modal-form-selectorCName').value = tr.find('td:eq(2)').text();
    document.getElementById('modal-form-selectorKind').value = tr.find('td:eq(3)').text();
    $('#modal-form-selector').modal('show');
    return false;
}

jQuery(function($) {
    if (!ace.vars['touch']) {
        $('.chosen-select').chosen({allow_single_deselect:true});

        $(window)
        .off('resize.chosen')
        .on('resize.chosen', function() {
            $('.chosen-select').each(function() {
                var $this = $(this);
                $this.next().css({'width': $this.parent().width()});
            })
        }).trigger('resize.chosen');

        $('#modal-form').on('show.bs.modal', function() {
            if (!ace.vars['touch']) {
                $(this).find('.chosen-container').each(function() {
                    $(this).find('a:first-child').css('width', '210px');
                    $(this).find('.chosen-drop').css('width', '210px');
                    $(this).find('.chosen-search input').css('width', '210px');
                });
            }
        });
    }

    {%- for item in ('user', 'group', 'selector') -%}
        $('#modal-form-add-{{ item }} form.form-horizontal').validate({
            errorElement: 'div',
            errorClass: 'help-block',
            focusInvalid: false,
            ignore: '',
            highlight: function(e) {
                $(e).closest('.form-group').removeClass('has-info').addClass('has-error');
            },
            success: function(e) {
                $(e).closest('.form-group').removeClass('has-error');
                $(e).remove();
            },
            errorPlacement: function(error, element) {
                if (element.is('input[type=checkbox]') || element.is('input[type=radio]')) {
                    var controls = element.closest('div[class*="col-"]');
                    if (controls.find(':checkbox,:radio').length > 1) controls.append(error);
                    else error.insertAfter(element.nextAll('.lbl:eq(0)').eq(0));
                } else if (element.is('.select2')) {
                    error.insertAfter(element.siblings('[class*="select2-container"]:eq(0)'));
                } else if (element.is('.chosen-select')) {
                    error.insertAfter(element.siblings('[class*="chosen-container"]:eq(0)'));
                } else {
                    error.insertAfter(element.parent());
                }
            },
            submitHandler: function(form) {
                create_{{ item }}(form);
            },
            invalidHandler: function(form) {
            }
        });
        $('#modal-form-{{ item }} form.form-horizontal').validate({
            errorElement: 'div',
            errorClass: 'help-block',
            focusInvalid: false,
            ignore: '',
            highlight: function(e) {
                $(e).closest('.form-group').removeClass('has-info').addClass('has-error');
            },
            success: function(e) {
                $(e).closest('.form-group').removeClass('has-error');
                $(e).remove();
            },
            errorPlacement: function(error, element) {
                if (element.is('input[type=checkbox]') || element.is('input[type=radio]')) {
                    var controls = element.closest('div[class*="col-"]');
                    if (controls.find(':checkbox,:radio').length > 1) controls.append(error);
                    else error.insertAfter(element.nextAll('.lbl:eq(0)').eq(0));
                } else if (element.is('.select2')) {
                    error.insertAfter(element.siblings('[class*="select2-container"]:eq(0)'));
                } else if (element.is('.chosen-select')) {
                    error.insertAfter(element.siblings('[class*="chosen-container"]:eq(0)'));
                } else {
                    error.insertAfter(element.parent());
                }
            },
            submitHandler: function(form) {
                put_{{ item }}(form);
            },
            invalidHandler: function(form) {
            }
        });
    {%- endfor -%}
})
</script>
{% endblock %}
